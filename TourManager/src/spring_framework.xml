<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:jdbc="http://www.springframework.org/schema/jdbc"
	xsi:schemaLocation="
     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
     http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
     http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc-3.0.xsd">
	
	<!-- 数据库配置jndi-->
	<bean name="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName" value="java:comp/env/jdbc/mysql"></property>
	</bean>
	 
	<!-- 读取ibatis配置文件 -->
	<!-- org.springframework.orm.ibatis.SqlMapClientFactoryBean -->
	<bean id="sqlMapClient" class="org.springframework.orm.ibatis.SqlMapClientFactoryBean">
		<property name="dataSource" ref="dataSource"></property>
		<property name="configLocation">
			<value>classpath:ibatis_framework.xml</value>
		</property>
	</bean>
	
	<!-- Spring iBatisTemplate -->
	<bean id="sqlMapClientTemplate" class="org.springframework.orm.ibatis.SqlMapClientTemplate">
		<property name="sqlMapClient" ref="sqlMapClient"></property>
	</bean>
	
	<!-- 事物管理器 ibatis -->
	<bean id="transactionManager"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource"></property>
	</bean>
	
	<!-- 代理工厂 -->
	<!-- 代理类的配置,将实现层与实务层剥离 ,采用spring的AOP技术实现，只需配置就好，无需新建类 -->
	<bean id="baseTransactionProxy"
		class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
		abstract="true">
		<property name="transactionManager" ref="transactionManager"></property>
		<property name="transactionAttributes">
			<props>
				<prop key="save*">PROPAGATION_REQUIRED</prop>    <!-- 增 -->
				<prop key="update*">PROPAGATION_REQUIRED</prop>  <!-- 改 -->
				<prop key="del*">PROPAGATION_REQUIRED</prop>     <!-- 删 -->
				<prop key="modify*">PROPAGATION_REQUIRED</prop>  <!-- 改 -->
			</props>
		</property>
	</bean>
	
	<!-- SmUser实体Bean -->
	<bean id="smUserDao" class="com.tour.dao.impl.SmUserDAOImpl" >
		<property name="sqlMapClientTemplate" ref="sqlMapClientTemplate"></property>
	</bean>
	
	<bean id="smUserService" class="com.tour.service.impl.SmUserServiceImpl">
		<property name="smUserDao" ref="smUserDao"></property>
	</bean>
	
	<bean id="smUserServiceProxy" parent="baseTransactionProxy">
		<property name="target" ref="smUserService"></property>
	</bean>
	
	<bean name="aliasSmUserAction" class="com.tour.web.SmUserAction" scope="prototype">
		<property name="smUserServiceProxy" ref="smUserServiceProxy"></property>
	</bean>

</beans>